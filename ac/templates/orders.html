{% extends "base.html" %}

{% block content %}
  {{ block.super }}
{% if user.user_type == 'agent' %}
      <div class="toolbar">
        <a href="{% url 'order_create' %}" class="btn btn-success mb-4" role="button" aria-disabled="true">Create New Order</a>
      </div>
{% endif %}
          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header card-header-success card-header-icon">
                  <div class="card-icon">
                    <i class="material-icons">assignment</i>
                  </div>
                  <h4 class="card-title">Orders</h4>
                </div>
                <div class="card-body">

<!--                    search panel start-->
    {% if user.user_type == 'agent' %}
    <div class="card">
    <div class="card-body">
        <form method="POST" action="/orders">
            {% csrf_token %}
        <div class="row">
            <div class="col">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3">
                  <div class="form-group">
                    <label class="">Start Date</label>
                    <input type="date" class="form-control" value="{{start_date}}" name="start_date"/>
                  </div>
                  </div>
                  <div class="col-md-3">
                  <div class="form-group">
                    <label class="">End Date</label>
                    <input type="date" class="form-control" value="{{end_date}}" name="end_date" />
                  </div>
                  </div>
                    <div class="col-md-2">
                  <div class="form-group">
                    <label class="bmd-label-floating">MLS ID</label>
                    <input type="text" class="form-control" value="{{mls_id}}" name="mls_id" />
                  </div>
                  </div>
                  <div class="col-md-3">
                  <div class="form-group">
                    <label class="bmd-label-floating">Customer Email address</label>
                    <input type="text" class="form-control" value="{{customer_email}}"  name="customer_email" />
                  </div>
                  </div>
                    <div class="col-md-1">
                  <button type="submit" class="btn btn-success pull-right">Search</button>
                </div>
                </div>
                </div>
              </div>
            </div>
          </form>
    </div>
        </div>
<!--search panel end-->
                    {% endif %}

                  <div class="material-datatables">
                    <table id="datatables" class="table-show-readmore compact hover row-border stripe" cellspacing="0" width="100%" style="width:100%">
                        {% if user.user_type == 'agent' %}

                        <thead>
                        <tr>
                            <th style="width: 100px;">MLS Id</th>
                            <th style="width: 100px;">Status</th>
                            <th style="width: 300px;">Address</th>
<!--                            <th>Est. Closing Date</th>-->
<!--                            <th>Down Payment Status</th>-->
<!--                            <th>Escrow Status</th>-->
                            <th style="width: 200px;">Customer</th>
<!--                            <th>Agent</th>-->
                            <th>Audit</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for order in orders %}
                          <tr>
                              <td>
<!--                                <a class="text-success" href="/order/edit/{{order.pk}}">-->
                                <a style="font-weight: bold;" class="text-success" href="{% url 'order_edit' pk=order.pk %}">
                                  {{order.mls_id}}
                                </a>
                              </td>
                              <td>{{order.status}}</td>
                              <td>{{order.address1}} {{order.address2}}</td>
<!--                              <td>{{order.est_closing_str}}</td>-->
<!--                              <td>{{order.down_payment_status}}</td>-->
<!--                              <td>{{order.escrow_status}}</td>-->
                              <td>{{order.customer.first_name}} {{order.customer.last_name}}</td>
<!--                              <td>{{order.agent.first_name}} {{order.agent.last_name}}</td>-->
                              <td>
                                  <a style="color:green" href="{% url 'order_audit' pk=order.pk %}">
<!--                                  <i class="material-icons">plagiarism</i></a>-->
                                  <i class="material-icons">content_paste_search</i></a>
<!--                                  <i class="material-icons">manage_search</i></a>-->
<!--                                  <i class="material-icons">find_in_page</i></a>-->
                              </td>
                          </tr>
                        {% endfor %}
                        </tbody>
                        {% else %}
                        <thead>
                        <tr>
                            <th style="width: 60px;">MLS Id</th>
                            <th>Status</th>
                            <th>Address</th>
<!--                            <th>Est. Closing Date</th>-->
<!--                            <th>Down Payment Status</th>-->
<!--                            <th>Escrow Status</th>-->
<!--                            <th>Customer</th>-->
                            <th>Agent</th>
                        </tr>
                      </thead>

                      <tbody>
                         {% for order in orders %}
                          <tr>
                              <td>
                                <a style="font-weight: bold;" class="text-success" href="{% url 'customer_order_view' pk=order.pk %}">
                                  {{order.mls_id}}
                                </a>
                              </td>
                              <td>{{order.status}}</td>
                              <td>{{order.address1}} {{order.address2}}</td>
<!--                              <td>{{order.est_closing_str}}</td>-->
<!--                              <td>{{order.down_payment_status}}</td>-->
<!--                              <td>{{order.escrow_status}}</td>-->
<!--                              <td>{{order.customer.first_name}} {{order.customer.last_name}}</td>-->
                              <td>{{order.agent.first_name}} {{order.agent.last_name}}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                        {% endif %}
                    </table>
                  </div>
                </div>
                <!-- end content-->
              </div>
              <!--  end card  -->
            </div>
            <!-- end col-md-12 -->
          </div>
          <!-- end row -->
{% endblock %}